(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{402:function(t,v,_){t.exports=_.p+"assets/img/http-3-1.c2736a46.png"},440:function(t,v,_){"use strict";_.r(v);var e=_(44),i=Object(e.a)({},(function(){var t=this,v=t.$createElement,e=t._self._c||v;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"http的缓存类型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http的缓存类型"}},[t._v("#")]),t._v(" http的缓存类型")]),t._v(" "),e("p",[e("strong",[t._v("强缓存：")]),t._v(" 浏览器直接从本地缓存中获取数据，不与服务器进行交互")]),t._v(" "),e("p",[e("strong",[t._v("协商缓存：")]),t._v(" 浏览器发送请求到服务器，服务器判定是否可以使用本地缓存")]),t._v(" "),e("ul",[e("li",[t._v("强缓存和协商缓存最终使用的都是本地缓存；区别在于是否与服务器进行交互")])]),t._v(" "),e("p",[e("strong",[t._v("图解：")]),e("br"),t._v(" "),e("img",{attrs:{src:_(402),alt:"image"}})]),t._v(" "),e("p",[e("strong",[t._v("缓存相关header：")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}}),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Expires")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("响应头")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("代表该资源的过期时间，由服务器告诉浏览器")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Cache-Control")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("请求/响应头")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("缓存控制字段，精确控制缓存策略")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("If-Modified-Since")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("请求头")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("资源最近修改时间，由浏览器告诉服务器")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Last-Modified")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("响应头")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("资源最近修改时间，由服务器告诉浏览器")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("If-None-Match")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("请求头")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("缓存资源标识，由浏览器告诉服务器")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Etag")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("响应头")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("资源标识，由服务器告诉浏览器")])])])]),t._v(" "),e("p",[t._v("配对使用的字段：")]),t._v(" "),e("ul",[e("li",[t._v("If-Modified-Since 和 Last-Modified")]),t._v(" "),e("li",[t._v("If-None-Match 和 Etag")])]),t._v(" "),e("h2",{attrs:{id:"强缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#强缓存"}},[t._v("#")]),t._v(" 强缓存")]),t._v(" "),e("p",[e("strong",[t._v("由Expires 和 Cache-Control两个字段来判断缓存是否过期：")]),e("br"),t._v("\n1.查看缓存是否有"),e("pf",[t._v("Cache-Control")]),t._v("的\n"),e("pf",[t._v("s-maxage")]),t._v("或"),e("pf",[t._v("max-age")]),t._v("指令"),e("br"),t._v("\n2.如果有，使用响应报文生成时间"),e("pf",[t._v("Date + s-maxage/max-age")]),t._v("获得过期时间，再与当前时间进行比较"),e("br"),t._v("\n3.如果没有，比较"),e("pf",[t._v("Expires")]),t._v("的过期时间和当前时间")],1),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[e("pf",[t._v("Cache-Control")]),t._v("常用指令")],1),t._v(" "),e("ul",[e("li",[e("pf",[t._v("no-cache")]),t._v("：含义是不使用本地缓存，需要使用协商缓存，需要先与服务器确认缓存是否可用")],1),t._v(" "),e("li",[e("pf",[t._v("no-store")]),t._v("：禁用缓存")],1),t._v(" "),e("li",[e("pf",[t._v("public")]),t._v("：表明其他用户也可以使用缓存，适用于公共缓存服务器的情况")],1),t._v(" "),e("li",[e("pf",[t._v("private")]),t._v("：表明只有特定用户才能使用缓存，适用于公共缓存服务器的情况")],1)])]),t._v(" "),e("h2",{attrs:{id:"协商缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),e("p",[e("strong",[t._v("缓存过期了，但是不知道服务器的资源是否改变，所以需要与服务器协商判断：")]),e("br"),t._v(" "),e("strong",[t._v("浏览器：")]),e("br"),t._v("\n1.判断缓存是否有"),e("pf",[t._v("ETag")]),t._v("或者"),e("pf",[t._v("Last-Modified")]),t._v("字段"),e("br"),t._v("\n2.如果有，就发起一个http请求，在请求头中添加"),e("pf",[t._v("If-None-Match")]),t._v("(如果"),e("pf",[t._v("ETag")]),t._v("存在的话)\n和"),e("pf",[t._v("If-Modified-Since")]),t._v("(如果"),e("pf",[t._v("Last-Modified")]),t._v("存在)字段"),e("br"),t._v("\n3.如果没有，发起一个http请求，服务器直接返回资源"),e("br"),t._v(" "),e("strong",[t._v("服务器：")]),e("br"),t._v("\n1.浏览器如果同时发送了"),e("pf",[t._v("If-None-Match")]),t._v("和"),e("pf",[t._v("If-Modified-Since")]),t._v("字段，服务器只要比对\n"),e("pf",[t._v("If-None-Match")]),t._v("和"),e("pf",[t._v("ETag")]),t._v("的内容是否一致即可\n2.如果一致，服务器认为缓存可用，返回"),e("pf",[t._v("304")]),t._v("状态码，浏览器直接读取本地缓存"),e("br"),t._v("\n3.如果不一致，服务器返回其他状态码，并返回所请求资源")],1),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[e("pf",[t._v("If-None-Match")]),t._v("和"),e("pf",[t._v("ETag")])],1),t._v(" "),e("p",[t._v("这两个值都是"),e("strong",[t._v("服务器")]),t._v("为每份资源分配的唯一标识字符串")]),t._v(" "),e("ul",[e("li",[t._v("浏览器首次请求资源，服务器响应时会在响应报文头加入"),e("pf",[t._v("ETag")]),t._v("字段。资源更新"),e("pf",[t._v("ETag")]),t._v("值也会更新")],1),t._v(" "),e("li",[t._v("浏览器再次请求资源，就会带上"),e("pf",[t._v("If-None-Match")]),t._v("字段，它的值就是上次响应报文的"),e("pf",[t._v("ETag")])],1),t._v(" "),e("li",[t._v("服务器进行"),e("pf",[t._v("If-None-Match")]),t._v("和"),e("pf",[t._v("ETag")]),t._v("的比对......")],1)])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[e("pf",[t._v("If-Modified-Since")]),t._v("和"),e("pf",[t._v("Last-Modified")])],1),t._v(" "),e("p",[t._v("这两个值都是GMT格式的时间字符串")]),t._v(" "),e("ul",[e("li",[t._v("浏览器首次请求资源，服务器响应时会在响应报文头加入"),e("pf",[t._v("Last-Modified")]),t._v("字段，表示最后一次修改时间")],1),t._v(" "),e("li",[t._v("浏览器再次请求资源，就会带上"),e("pf",[t._v("If-Modified-Since")]),t._v("，它的值就是上次响应报文的"),e("pf",[t._v("Last-Modified")])],1),t._v(" "),e("li",[t._v("服务器进行"),e("pf",[t._v("If-Modified-Since")]),t._v("和"),e("pf",[t._v("Last-Modified")]),t._v("的比对.....")],1)]),t._v(" "),e("p",[t._v("但是与"),e("pf",[t._v("ETag")]),t._v("不同的是：比对结果是资源未更新可以使用本地缓存到时候，响应头不会添加"),e("pf",[t._v("Last-Modified")]),t._v("字段")],1)]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[e("pf",[t._v("ETag")]),t._v("对比"),e("pf",[t._v("Last-Modified")]),t._v("的优点")],1),t._v(" "),e("p",[t._v("主要是能解决几个"),e("pf",[t._v("Last-Modified")]),t._v("难以解决的问题：")],1),t._v(" "),e("ul",[e("li",[e("pf",[t._v("If-Modified-Since")]),t._v("的时间粒度是秒级的，如果文件是频繁修改的话，无法精准判断")],1),t._v(" "),e("li",[t._v("有些文件只改了修改时间，却没改内容")]),t._v(" "),e("li",[t._v("有些服务器不支持精确获取文件最后的修改时间")])]),t._v(" "),e("p",[e("pf",[t._v("Last-Modified")]),t._v("和"),e("pf",[t._v("ETag")]),t._v("是可以一起使用的，但是服务器优先验证"),e("pf",[t._v("ETag")])],1)])])}),[],!1,null,null,null);v.default=i.exports}}]);